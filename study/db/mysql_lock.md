# MySQL InnoDB 스토리지 엔진 Lock 종류

### 1. 레코드 락(Record Lock)
- **정의 :** 
  - 데이터베이스 테이블의 특정 행에 설정되는 락
  - 다른 트랜잭션이 해당 행을 수정하지 못하도록 방지
- **용도 :**
  - 주로 데이터를 변경하거나 조회할 때 사용
  - 특정 행을 업데이트하거나 삭제하기 전에 해당 행에 레코드 락을 설정하여 다른 트랜잭션이 동시에 같은 행을 변경하는 것을 방지
--- 
### 2. 갭 락(Gap Lock)
- **정의 :**
  - 테이블의 레코드 사이의 공간, 즉 '갭'에 대한 락
  - 특정 범위에 새로운 행이 삽입되는 것을 방지
  - 트랜잭션이 동일한 갭에 대해 동시에 변경을 시도하는 것을 막는다
- **용도 :**
  - 주로 트랜잭션이 범위 쿼리를 수행할 때 사용되며, 특정 범위 내에서 팬텀 리드를 방지하는데 도움 됨
  > **팬텀 리드(Phantom Reads)** 는 한 트랜잭션 내에서 동일한 쿼리를 두 번 실행 했을 때, 첫 번째 쿼리 이후에 새로 삽입된 행 때문에 두 번째 쿼리 결과가 달라지는 현상
---
### 3. 넥스트-키 락(Next-Key Lock)
- **정의 :**
  - 레코드 락과 갭 락을 결합한 형태의 락
  - 특정 행과 그 행 바로 앞의 갭에 대한 락을 동시에 설정
- **용도 :**
  - InnoDB에서 트랜잭션의 격리 수준이 '반복 가능한 읽기(Repeatable Read)' 일 때 기본적으로 샤용되고, 팬텀 리드를 방지한다
  - 트랜잭션이 범위 쿼리를 수행할 때 해당 범위 내의 모든 행과 갭을 락으로 보호한다
  - 쿼리가 실행되는 동안 새로운 행의 삽입이나 기존 행의 변경을 방지한다
---
### 4. 오토-인크리먼트 락(Auto-Increment Lock)
- **정의 :**
  - 오토-인크리먼트 컬럼 값을 생성할 때 사용
  - 동시에 여러 트랜잭션이 같은 테이블에 레코드를 삽입할 때 중복된 오토-인크리먼트 값이 생성되는 것을 방지
- **용도 :**
  - **전통적인 락 :**
    - 테이블 단위로 락을 건다
    - INSERT 작업 사이에 성능 저하를 일으킬 수 있다.
  - **연속적인 락 :**
    - 위 성능 문제를 해결하기 위해 도입되었음.
---
### 5. 메타데이터 락(Metadata Lock)
- **정의 :**
  - 테이블의 구조(예:테이블의 정의)를 변경하는 작업을 안전하게 수행하기 위해 사용
- **용도 :**
  - 테이블에 대한 DDL 작업이 실행될 때, InnoDB는 해당 테이블에 메타데이터 락을 걸어 다른 트랜잭션이 동시에 테이블을 변경하거나 무결성에 영향을 줄 수 있는 작업을 수행하는 것을 방지한다.
---
### 6. 테이블 락(Table Lock)
- **정의 :**
  - InnoDB는 내부적으로 테이블 락을 사용하여 특정 SQL 작업을 최적화한다
  - 예를 들어, MySQL 옵티마이저가 쿼리를 처리할 때, 테이블 락을 사용하여 필요한 테이블에 대한 접근을 관리한다
- **용도 :**
  - 읽기 작업에서 동시성을 증가시키는데 도움이 된다
  - InnoDB는 주로 행 레벨 락을 사용하여 높은 동시성을 제공한다
---
### 7. 래치(Latche) 및 뮤텍스(Mutex)
- **정의 :**
  - 래치와 뮤텍스는 InnoDB 내부에서 사용되는 낮은 수준의 동기화 매커니즘이다
  - 데이터 구조를 보호하고, 동시에 여러 스레드가 같은 데이터에 접근할 때 발생할 수 있는 충돌을 방지한다.
- **용도 :**
  - 뮤텍스는 일반적으로 하나의 스레드만이 특정 시점에 데이터 구조를 수정할 수 있도록 한다.
  - 래치는 더 넓은 범위의 동기화 매커니즘을 제공하며, 공유 또는 배타적 접근을 위해 사용될 수 있다.
