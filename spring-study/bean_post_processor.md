# 빈 후처리기(BeanPostProcess)

생성한 객체를 빈 저장소에 등록하기 전에 조작하기 위한 기능

컴포넌트 스캔일 경우 프록시 팩토리를 적용할세도 없이 스프링 빈에 등록되어 프록시 설정이 불가능하다.
컴포넌트 스캔으로 빈으로 등록되는 객체에도 프록시 설정을 하라면 빈 후처리기를 사용해야 한다.

스프링은 빈 후처리기를 제공해 준다.

---
**자동 프록시 생성기 - AutoProxyCreator**
* 스프링 부트 자동 설정으로 `AnnotationAwareAspectJAutoProxyCreator` 라는 빈 후처리 기가 스프링 빈에 자동으로 등록된다.
* 이름 그대로 자동으로 프록시를 생성해주는 빈 후처리기이다.
* 이 빈 후처리기는 스프링 빈으로 등록된 `Advisor` 들을 자동으로 찾아서 프록시가 필요한 곳에 자동으로 프록시 를 적용해준다. 
* `Advisor` 안에는 `Pointcut` 과 `Advice` 가 이미 모두 포함되어 있다. 따라서 `Advisor` 만 알고 있으면 그 안 에 있는 `Pointcut` 으로 어떤 스프링 빈에 프록시를 적용해야 할지 알 수 있다. 그리고 `Advice` 로 부가 기능을 적용하면 된다. 
---
**자동 프록시 생성기의 작동 과정**
* **1. 생성**:스프링이 스프링 빈 대상이 되는 객체를 생성한다. ( `@Bean` , 컴포넌트 스캔 모두 포함)
* **2. 전달:** 생성된 객체를 빈 저장소에 등록하기 직전에 빈 후처리기에 전달한다.
* **3. 모든 Advisor 빈 조회:** 자동 프록시 생성기 - 빈 후처리기는 스프링 컨테이너에서 모든 `Advisor` 를 조회한다.
* **4. 프록시 적용 대상 체크:** 앞서 조회한 `Advisor` 에 포함되어 있는 포인트컷을 사용해서 해당 객체가 프록시를 적용할 대상인지 아닌지 판단한다. 이때 객체의 클래스 정보는 물론이고, 해당 객체의 모든 메서드를 포인트컷에 하나하나 모두 매칭해본다. 그래서 조건이 하나라도 만족하면 프록시 적용 대상이 된다. 예를 들어서 10개의 메서 드 중에 하나만 포인트컷 조건에 만족해도 프록시 적용 대상이 된다.
* **5. 프록시 생성:** 프록시 적용 대상이면 프록시를 생성하고 반환해서 프록시를 스프링 빈으로 등록한다. 만약 프록 시 적용 대상이 아니라면 원본 객체를 반환해서 원본 객체를 스프링 빈으로 등록한다.
* **6. 빈 등록:** 반환된 객체는 스프링 빈으로 등록된다. 
